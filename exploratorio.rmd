---
title: "Análisis exploratorio"
author: "Tamara Ricardo"
date: "`r Sys.Date()`"
output: word_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = F, warning = F, message = F)
```

```{r}
# Carga paquetes ----------------------------------------------------------
pacman::p_load(
  # Statistical analysis
  glmmTMB, 
  survival,
  # Inference and residuals
  DHARMa,
  performance,
  # Exploratory analysis
  compareGroups,
  gtsummary,
  dlookr,
  # Read files
  rio,
  # Data cleaning
  janitor,
  # Data management
  tidyverse
)

# Carga datos -------------------------------------------------------------
df = import("datos_CA_COVID_clean.xlsx") %>% 
  ### Variables categóricas a factor
  mutate(across(where(is.character)|matches("idpte"),
                as.factor))
```

### Valores ausentes
```{r}
### Explora valores faltantes
df %>% plot_na_pareto(only_na = T)
```

\pagebreak

### Descripción de la muestra
```{r}
### Frecuencia variables muestra completa
df %>% select(edad, edad_cat, sexo, starts_with("comorb"), icd10_cat_1, 
              tipo_CA_1, evol_CA_1, ecog, gravedad_CA, metastasis, 
              mas_un_tumor, cat_dx_covid) %>% 
  tbl_summary(missing = "no")
```

\pagebreak

### Compara pacientes con y sin diagnóstico de COVID-19
```{r}
### Frecuencia variables según diagnóstico COVID
df %>% select(edad, edad_cat, sexo, starts_with("comorb"),  
              tipo_CA_1, evol_CA_1, ecog, gravedad_CA, metastasis, 
              mas_un_tumor, cat_dx_covid) %>% 
  tbl_summary(by = cat_dx_covid, percent = "col", missing = "no") %>% 
  add_p() %>% 
  bold_p() %>% 
  bold_labels()
```

\pagebreak

## Análisis datos para pacientes con datos completos (n = 321)
```{r}
# Filtra datos con información comorbilidades -----------------------------
df_comorb <- df %>% select(idpte, edad, edad_cat, sexo, starts_with("comorb"),
                          icd10_cat_1, tipo_CA_1, evol_CA_1, ecog, gravedad_CA, 
                          metastasis, mas_un_tumor, cat_dx_covid) %>% 
  drop_na()

### Frecuencia variables según diagnóstico COVID
df %>% select(edad, edad_cat, sexo, starts_with("comorb"),  
              tipo_CA_1, evol_CA_1, ecog, gravedad_CA, metastasis, 
              mas_un_tumor, cat_dx_covid) %>% 
  tbl_summary(by = cat_dx_covid, percent = "col", missing = "no") %>% 
  add_p() %>% 
  bold_p() %>% 
  bold_labels()
```

